<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RRGY51J5ZH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RRGY51J5ZH');
    </script>
    <link rel="index" title="Index" href="../../../genindex/" /><link rel="search" title="Search" href="../../../search/" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>viser._scene_api - viser</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b20cc3f5" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=5976cbfc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/ansi.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-code-background: #f4f4f4;
  --color-code-foreground: #000;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../"><div class="brand">viser</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../">
    
    <div class="sidebar-logo-container" style="margin: .5rem 1em .5rem 0">
        <img class="sidebar-logo only-light" src="../../../_static/logo.svg" alt="logo" />
        <img class="sidebar-logo only-dark" src="../../../_static/logo.svg" alt="logo" />
    </div>
    <!-- <span class="sidebar-brand-text">viser</span> -->

    
</a>

<!-- Dropdown for different versions of the viser docs. Slightly hacky. -->
<div style="padding: 0 1em;">
    <script>
      var viserDocsVersionsPopulated = false;

      async function getViserVersionList() {
        // This index.txt file is written by the docs.yml GitHub action.
        // https://github.com/nerfstudio-project/viser/blob/main/.github/workflows/docs.yml
        const response = await fetch(
          "https://viser.studio/versions/index.txt",
          { cache: "no-cache" }
        );
        return await response.text();
      }
      async function viserDocsPopulateVersionDropDown () {
        // Load the version list lazily...
        if (viserDocsVersionsPopulated) {
          return;
        }
        viserDocsVersionsPopulated = true;

        console.log("Populating docs version list!")
        const versions = (await getViserVersionList()).trim().split("\n").reverse();
        console.log(versions);
        let htmlString = "<ul style='margin: 0.5rem 0 0 0'>";
        htmlString += `<li><a href="https://viser.studio/latest">latest</a></li>`;
        for (let version of versions) {
          htmlString += `<li><a href="https://viser.studio/versions/${version}">${version}</a></li>`;
        }

        htmlString += "</ul>";
        document.getElementById("viser-version-dropdown").innerHTML = htmlString;
      }
    </script>
    <details
        style="padding: 0.5rem; background: var(--color-background-primary); border-radius: 0.5rem; border: 1px solid var(--color-sidebar-background-border);"
        ontoggle="viserDocsPopulateVersionDropDown()"
    >
    <summary style="cursor: pointer;"><strong>Version:</strong> <em>latest</em></summary>
      <div id="viser-version-dropdown"></div>
    </details>
    <!-- End dropdown -->
</div>

<div style="text-align: left; padding: 1em">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <a class="github-button" href="https://github.com/nerfstudio-project/viser"
        data-color-scheme="no-preference: light; light: light; dark: light;" data-size="large" data-show-count="true"
        aria-label="Download buttons/github-buttons on GitHub">
        Github
    </a>
</div><form class="sidebar-search-container" method="get" action="../../../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../conventions/">Frame Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/">Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API (Basics)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../server/">Viser Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scene_api/">Scene API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gui_api/">GUI API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API (Advanced)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../client_handles/">Client Handles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../camera_handles/">Camera Handles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gui_handles/">GUI Handles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scene_handles/">Scene Handles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../icons/">Icons</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API (Auxiliary)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../transforms/">Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infrastructure/">Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extras/">Record3D + URDF Helpers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/00_coordinate_frames/">Coordinate frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/01_image/">Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/02_gui/">GUI basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/03_gui_callbacks/">GUI callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/04_camera_poses/">Camera poses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/05_camera_commands/">Camera commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/06_mesh/">Meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/07_record3d_visualizer/">Record3D visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/08_smpl_visualizer/">SMPL model visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/09_urdf_visualizer/">Robot URDF visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/10_realsense/">RealSense visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/11_colmap_visualizer/">COLMAP visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/12_click_meshes/">Mesh click events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/13_theming/">Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/14_markdown/">Markdown Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/15_gui_in_scene/">3D GUI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/16_modal/">Modal basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/17_background_composite/">Depth compositing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/18_splines/">Splines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/19_get_renders/">Get Renders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/20_scene_pointer/">Scene pointer events.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/21_set_up_direction/">Set Up Direction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/22_games/">Games</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/23_plotly/">Plotly.</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for viser._scene_api</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">get_args</span>

<span class="kn">import</span> <span class="nn">imageio.v3</span> <span class="k">as</span> <span class="nn">iio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">onp</span>
<span class="kn">import</span> <span class="nn">numpy.typing</span> <span class="k">as</span> <span class="nn">onpt</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">TypeAlias</span><span class="p">,</span> <span class="n">assert_never</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_messages</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">transforms</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">from</span> <span class="nn">._scene_handles</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BatchedAxesHandle</span><span class="p">,</span>
    <span class="n">CameraFrustumHandle</span><span class="p">,</span>
    <span class="n">FrameHandle</span><span class="p">,</span>
    <span class="n">GlbHandle</span><span class="p">,</span>
    <span class="n">Gui3dContainerHandle</span><span class="p">,</span>
    <span class="n">ImageHandle</span><span class="p">,</span>
    <span class="n">LabelHandle</span><span class="p">,</span>
    <span class="n">MeshHandle</span><span class="p">,</span>
    <span class="n">PointCloudHandle</span><span class="p">,</span>
    <span class="n">SceneNodeHandle</span><span class="p">,</span>
    <span class="n">SceneNodePointerEvent</span><span class="p">,</span>
    <span class="n">ScenePointerEvent</span><span class="p">,</span>
    <span class="n">TransformControlsHandle</span><span class="p">,</span>
    <span class="n">_SceneNodeHandleState</span><span class="p">,</span>
    <span class="n">_TransformControlsState</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">trimesh</span>

    <span class="kn">from</span> <span class="nn">._viser</span> <span class="kn">import</span> <span class="n">ClientHandle</span><span class="p">,</span> <span class="n">ViserServer</span>
    <span class="kn">from</span> <span class="nn">.infra</span> <span class="kn">import</span> <span class="n">ClientId</span>


<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_colors_to_uint8</span><span class="p">(</span><span class="n">colors</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">onpt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">onp</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert intensity values to uint8. We assume the range [0,1] for floats, and</span>
<span class="sd">    [0,255] for integers. Accepts any shape.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">colors</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">onp</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">onp</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">onp</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">colors</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">onp</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">onp</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colors</span>


<span class="n">RgbTupleOrArray</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">_encode_rgb</span><span class="p">(</span><span class="n">rgb</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">rgb</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
    <span class="n">rgb_fixed</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="n">value</span> <span class="k">if</span> <span class="n">onp</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">onp</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rgb</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb_fixed</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb_fixed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">256</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">rgb_fixed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">+</span> <span class="n">rgb_fixed</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_encode_image_base64</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">],</span>
    <span class="n">jpeg_quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="n">media_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">]</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">_colors_to_uint8</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">data_buffer</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;png&quot;</span><span class="p">:</span>
            <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;image/png&quot;</span>
            <span class="n">iio</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">data_buffer</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">:</span>
            <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;image/jpeg&quot;</span>
            <span class="n">iio</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
                <span class="n">data_buffer</span><span class="p">,</span>
                <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span>  <span class="c1"># Strip alpha.</span>
                <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span>
                <span class="n">quality</span><span class="o">=</span><span class="mi">75</span> <span class="k">if</span> <span class="n">jpeg_quality</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">jpeg_quality</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">assert_never</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>

        <span class="n">base64_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">base64_data</span>


<span class="n">TVector</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;TVector&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">cast_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">TVector</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TVector</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">cast</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span>
            <span class="n">length</span><span class="p">,</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected vector of shape </span><span class="si">{</span><span class="p">(</span><span class="n">length</span><span class="p">,)</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> instead&quot;</span>
    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">TVector</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">vector</span><span class="p">)))</span>


<div class="viewcode-block" id="SceneApi">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi">[docs]</a>
<span class="k">class</span> <span class="nc">SceneApi</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for adding 3D primitives to the scene.</span>

<span class="sd">    Used by both our global server object, for sharing the same GUI elements</span>
<span class="sd">    with all clients, and by invidividual client handles.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">ViserServer</span> <span class="o">|</span> <span class="n">ClientHandle</span><span class="p">,</span>  <span class="c1"># Who do I belong to?</span>
        <span class="n">thread_executor</span><span class="p">:</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">._viser</span> <span class="kn">import</span> <span class="n">ViserServer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity that owns this API.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">owner</span><span class="o">.</span><span class="n">_websock_server</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">ViserServer</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">owner</span><span class="o">.</span><span class="n">_websock_connection</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interface for sending and listening to messages.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">world_axes</span><span class="p">:</span> <span class="n">FrameHandle</span> <span class="o">=</span> <span class="n">FrameHandle</span><span class="p">(</span>
            <span class="n">_SceneNodeHandleState</span><span class="p">(</span>
                <span class="s2">&quot;/WorldAxes&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">wxyz</span><span class="o">=</span><span class="n">onp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>
                <span class="n">position</span><span class="o">=</span><span class="n">onp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle for the world axes, which are created by default.&quot;&quot;&quot;</span>

        <span class="c1"># Hide world axes on initialization.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">ViserServer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world_axes</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_from_transform_controls_name</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span> <span class="n">TransformControlsHandle</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_from_node_name</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SceneNodeHandle</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_cb</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ScenePointerEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_done_cb</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_event_type</span><span class="p">:</span> <span class="n">_messages</span><span class="o">.</span><span class="n">ScenePointerEventType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">TransformControlsUpdateMessage</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_transform_controls_updates</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">SceneNodeClickMessage</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_node_click_updates</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">ScenePointerMessage</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_scene_pointer_updates</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span> <span class="o">=</span> <span class="n">thread_executor</span>

<div class="viewcode-block" id="SceneApi.set_up_direction">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.set_up_direction">[docs]</a>
    <span class="k">def</span> <span class="nf">set_up_direction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;+x&quot;</span><span class="p">,</span> <span class="s2">&quot;+y&quot;</span><span class="p">,</span> <span class="s2">&quot;+z&quot;</span><span class="p">,</span> <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="s2">&quot;-z&quot;</span><span class="p">]</span>
        <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
        <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the global up direction of the scene. By default we follow +Z-up</span>
<span class="sd">        (similar to Blender, 3DS Max, ROS, etc), the most common alternative is</span>
<span class="sd">        +Y (OpenGL, Maya, etc).</span>

<span class="sd">        Args:</span>
<span class="sd">            direction: New up direction. Can either be a string (one of +x, +y,</span>
<span class="sd">                +z, -x, -y, -z) or a length-3 direction vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;+x&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;+y&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;+z&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;-x&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;-y&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;-z&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">}[</span><span class="n">direction</span><span class="p">]</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

        <span class="n">default_three_up</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">rotate_between</span><span class="p">(</span><span class="n">before</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">SO3</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">before</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">after</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
            <span class="n">before</span> <span class="o">=</span> <span class="n">before</span> <span class="o">/</span> <span class="n">onp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
            <span class="n">after</span> <span class="o">=</span> <span class="n">after</span> <span class="o">/</span> <span class="n">onp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>

            <span class="n">angle</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">onp</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">onp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
                <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">onp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">before</span><span class="p">))</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">unit_vector</span><span class="p">)</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="o">/</span> <span class="n">onp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">SO3</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">axis</span><span class="p">)</span>

        <span class="n">R_threeworld_world</span> <span class="o">=</span> <span class="n">rotate_between</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">default_three_up</span><span class="p">)</span>

        <span class="c1"># Rotate the world frame such that:</span>
        <span class="c1">#     If we set +Y to up, +X and +Z should face the camera.</span>
        <span class="c1">#     If we set +Z to up, +X and +Y should face the camera.</span>
        <span class="c1"># In App.tsx, the camera is initialized at [-3, 3, -3] in the threejs</span>
        <span class="c1"># coordinate frame.</span>
        <span class="n">desired_fwd</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span> <span class="o">/</span> <span class="n">onp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">current_fwd</span> <span class="o">=</span> <span class="n">R_threeworld_world</span> <span class="o">@</span> <span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">onp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">))</span>
        <span class="n">current_fwd</span> <span class="o">=</span> <span class="n">current_fwd</span> <span class="o">*</span> <span class="n">onp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">current_fwd</span> <span class="o">=</span> <span class="n">current_fwd</span> <span class="o">/</span> <span class="n">onp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">current_fwd</span><span class="p">)</span>
        <span class="n">R_threeworld_world</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">SO3</span><span class="o">.</span><span class="n">from_y_radians</span><span class="p">(</span>  <span class="c1"># Rotate around the null space / up direction.</span>
                <span class="n">onp</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                    <span class="n">onp</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">current_fwd</span><span class="p">,</span> <span class="n">desired_fwd</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">onp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">current_fwd</span><span class="p">,</span> <span class="n">desired_fwd</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>
<div class="viewcode-block" id="SceneApi.set_global_visibility">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.set_global_visibility">[docs]</a>
            <span class="o">@</span> <span class="n">R_threeworld_world</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">onp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">R_threeworld_world</span><span class="o">.</span><span class="n">wxyz</span><span class="p">)):</span>
            <span class="c1"># Set the orientation of the root node.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
                <span class="n">_messages</span><span class="o">.</span><span class="n">SetOrientationMessage</span><span class="p">(</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cast_vector</span><span class="p">(</span><span class="n">R_threeworld_world</span><span class="o">.</span><span class="n">wxyz</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">set_global_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set visibility for all scene nodes. If set to False, all scene nodes</span>
<span class="sd">        will be hidden.</span>

<span class="sd">        This can be useful when we&#39;ve called</span>
<span class="sd">        :meth:`SceneApi.set_background_image()`, and want to hide everything</span>
<span class="sd">        except for the background.</span>

<span class="sd">        Args:</span>
<span class="sd">            visible: Whether or not all scene nodes should be visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">SetSceneNodeVisibilityMessage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_glb">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_glb">[docs]</a>
    <span class="k">def</span> <span class="nf">add_glb</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">glb_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlbHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a general 3D asset via binary glTF (GLB).</span>

<span class="sd">        For glTF files, it&#39;s often simpler to use `trimesh.load()` with</span>
<span class="sd">        `.add_mesh_trimesh()`. This will call `.add_glb()` under the hood.</span>

<span class="sd">        For glTF features not supported by trimesh, glTF to GLB conversion can</span>
<span class="sd">        also be done programatically with libraries like `pygltflib`.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">              define a kinematic tree.</span>
<span class="sd">            glb_data: A binary payload.</span>
<span class="sd">            scale: A scale for resizing the GLB asset.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">GlbMessage</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">glb_data</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">GlbHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_spline_catmull_rom">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_spline_catmull_rom">[docs]</a>
    <span class="k">def</span> <span class="nf">add_spline_catmull_rom</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">positions</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">curve_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;centripetal&quot;</span><span class="p">,</span> <span class="s2">&quot;chordal&quot;</span><span class="p">,</span> <span class="s2">&quot;catmullrom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centripetal&quot;</span><span class="p">,</span>
        <span class="n">tension</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SceneNodeHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a spline to the scene using Catmull-Rom interpolation.</span>

<span class="sd">        This method creates a spline based on a set of positions and interpolates</span>
<span class="sd">        them using the Catmull-Rom algorithm. This can be used to create smooth curves.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            positions: A tuple of 3D positions (x, y, z) defining the spline&#39;s path.</span>
<span class="sd">            curve_type: Type of the curve (&#39;centripetal&#39;, &#39;chordal&#39;, &#39;catmullrom&#39;).</span>
<span class="sd">            tension: Tension of the curve. Affects the tightness of the curve.</span>
<span class="sd">            closed: Boolean indicating if the spline is closed (forms a loop).</span>
<span class="sd">            line_width: Width of the spline line.</span>
<span class="sd">            color: Color of the spline as an RGB tuple.</span>
<span class="sd">            segments: Number of segments to divide the spline into.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">positions</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">CatmullRomSplineMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">positions</span><span class="p">,</span>
                <span class="n">curve_type</span><span class="p">,</span>
                <span class="n">tension</span><span class="p">,</span>
                <span class="n">closed</span><span class="p">,</span>
                <span class="n">line_width</span><span class="p">,</span>
                <span class="n">_encode_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
                <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">SceneNodeHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_spline_cubic_bezier">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_spline_cubic_bezier">[docs]</a>
    <span class="k">def</span> <span class="nf">add_spline_cubic_bezier</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">positions</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">control_points</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SceneNodeHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a spline to the scene using Cubic Bezier interpolation.</span>

<span class="sd">        This method allows for the creation of a cubic Bezier spline based on given</span>
<span class="sd">        positions and control points. It is useful for creating complex, smooth,</span>
<span class="sd">        curving shapes.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            positions: A tuple of 3D positions (x, y, z) defining the spline&#39;s key points.</span>
<span class="sd">            control_points: A tuple of control points for Bezier curve shaping.</span>
<span class="sd">            line_width: Width of the spline line.</span>
<span class="sd">            color: Color of the spline as an RGB tuple.</span>
<span class="sd">            segments: Number of segments to divide the spline into.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">positions</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_points</span><span class="p">,</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">control_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="n">control_points</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">control_points</span><span class="p">))</span>  <span class="c1"># type: ignore</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_points</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_points</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">CubicBezierSplineMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">positions</span><span class="p">,</span>
                <span class="n">control_points</span><span class="p">,</span>
                <span class="n">line_width</span><span class="p">,</span>
                <span class="n">_encode_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
                <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">SceneNodeHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_camera_frustum">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_camera_frustum">[docs]</a>
    <span class="k">def</span> <span class="nf">add_camera_frustum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">fov</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">aspect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">,</span>
        <span class="n">jpeg_quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CameraFrustumHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a camera frustum to the scene for visualization.</span>

<span class="sd">        This method adds a frustum representation, typically used to visualize the</span>
<span class="sd">        field of view of a camera. It&#39;s helpful for understanding the perspective</span>
<span class="sd">        and coverage of a camera in the 3D space.</span>

<span class="sd">        Like all cameras in the viser Python API, frustums follow the OpenCV [+Z forward,</span>
<span class="sd">        +X right, +Y down] convention. fov is vertical in radians; aspect is width over height</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            fov: Field of view of the camera (in radians).</span>
<span class="sd">            aspect: Aspect ratio of the camera (width over height).</span>
<span class="sd">            scale: Scale factor for the size of the frustum.</span>
<span class="sd">            color: Color of the frustum as an RGB tuple.</span>
<span class="sd">            image: Optional image to be displayed on the frustum.</span>
<span class="sd">            format: Format of the provided image (&#39;png&#39; or &#39;jpeg&#39;).</span>
<span class="sd">            jpeg_quality: Quality of the jpeg image (if jpeg format is used).</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">media_type</span><span class="p">,</span> <span class="n">base64_data</span> <span class="o">=</span> <span class="n">_encode_image_base64</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">jpeg_quality</span><span class="o">=</span><span class="n">jpeg_quality</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">media_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">base64_data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">CameraFrustumMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">fov</span><span class="o">=</span><span class="n">fov</span><span class="p">,</span>
                <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="c1"># (255, 255, 255) =&gt; 0xffffff, etc</span>
                <span class="n">color</span><span class="o">=</span><span class="n">_encode_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
                <span class="n">image_media_type</span><span class="o">=</span><span class="n">media_type</span><span class="p">,</span>
                <span class="n">image_base64_data</span><span class="o">=</span><span class="n">base64_data</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">CameraFrustumHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_frame">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">add_frame</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">show_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">axes_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">axes_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span>
        <span class="n">origin_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrameHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a coordinate frame to the scene.</span>

<span class="sd">        This method is used for adding a visual representation of a coordinate</span>
<span class="sd">        frame, which can help in understanding the orientation and position of</span>
<span class="sd">        objects in 3D space.</span>

<span class="sd">        For cases where we want to visualize many coordinate frames, like</span>
<span class="sd">        trajectories containing thousands or tens of thousands of frames,</span>
<span class="sd">        batching and calling `add_batched_axes()` may be a better choice than calling</span>
<span class="sd">        `add_frame()` in a loop.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            show_axes: Boolean to indicate whether to show the frame as a set of axes + origin sphere.</span>
<span class="sd">            axes_length: Length of each axis.</span>
<span class="sd">            axes_radius: Radius of each axis.</span>
<span class="sd">            origin_radius: Radius of the origin sphere. If not set, defaults to `2 * axes_radius`.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">origin_radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">origin_radius</span> <span class="o">=</span> <span class="n">axes_radius</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">FrameMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">show_axes</span><span class="o">=</span><span class="n">show_axes</span><span class="p">,</span>
                <span class="n">axes_length</span><span class="o">=</span><span class="n">axes_length</span><span class="p">,</span>
                <span class="n">axes_radius</span><span class="o">=</span><span class="n">axes_radius</span><span class="p">,</span>
                <span class="n">origin_radius</span><span class="o">=</span><span class="n">origin_radius</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">FrameHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_batched_axes">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_batched_axes">[docs]</a>
    <span class="k">def</span> <span class="nf">add_batched_axes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">batched_wxyzs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">batched_positions</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">axes_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">axes_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BatchedAxesHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize batched sets of coordinate frame axes.</span>

<span class="sd">        The functionality of `add_batched_axes()` overlaps significantly with</span>
<span class="sd">        `add_frame()` when `show_axes=True`. The primary difference is that</span>
<span class="sd">        `add_batched_axes()` supports multiple axes via the `wxyzs_batched`</span>
<span class="sd">        (shape Nx4) and `positions_batched` (shape Nx3) arguments.</span>

<span class="sd">        Axes that are batched and rendered via a single call to</span>
<span class="sd">        `add_batched_axes()` are instanced on the client; this will be much</span>
<span class="sd">        faster to render than `add_frame()` called in a loop.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            batched_wxyzs: Float array of shape (N,4).</span>
<span class="sd">            batched_positions: Float array of shape (N,3).</span>
<span class="sd">            axes_length: Length of each axis.</span>
<span class="sd">            axes_radius: Radius of each axis.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">                This will be applied to all axes.</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">                This will be applied to all axes.</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">batched_wxyzs</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">batched_wxyzs</span><span class="p">)</span>
        <span class="n">batched_positions</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">batched_positions</span><span class="p">)</span>

        <span class="n">num_axes</span> <span class="o">=</span> <span class="n">batched_wxyzs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">batched_wxyzs</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">num_axes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">batched_positions</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">num_axes</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">BatchedAxesMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">wxyzs_batched</span><span class="o">=</span><span class="n">batched_wxyzs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">positions_batched</span><span class="o">=</span><span class="n">batched_positions</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">axes_length</span><span class="o">=</span><span class="n">axes_length</span><span class="p">,</span>
                <span class="n">axes_radius</span><span class="o">=</span><span class="n">axes_radius</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">BatchedAxesHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_grid">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_grid">[docs]</a>
    <span class="k">def</span> <span class="nf">add_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">width_segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">height_segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">plane</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;xz&quot;</span><span class="p">,</span> <span class="s2">&quot;xy&quot;</span><span class="p">,</span> <span class="s2">&quot;yx&quot;</span><span class="p">,</span> <span class="s2">&quot;yz&quot;</span><span class="p">,</span> <span class="s2">&quot;zx&quot;</span><span class="p">,</span> <span class="s2">&quot;zy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;xy&quot;</span><span class="p">,</span>
        <span class="n">cell_color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span> <span class="o">=</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="n">cell_thickness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">cell_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">section_color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span> <span class="o">=</span> <span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
        <span class="n">section_thickness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">section_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SceneNodeHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a 2D grid to the scene.</span>

<span class="sd">        This can be useful as a size, orientation, or ground plane reference.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the grid.</span>
<span class="sd">            width: Width of the grid.</span>
<span class="sd">            height: Height of the grid.</span>
<span class="sd">            width_segments: Number of segments along the width.</span>
<span class="sd">            height_segments: Number of segments along the height.</span>
<span class="sd">            plane: The plane in which the grid is oriented (e.g., &#39;xy&#39;, &#39;yz&#39;).</span>
<span class="sd">            cell_color: Color of the grid cells as an RGB tuple.</span>
<span class="sd">            cell_thickness: Thickness of the grid lines.</span>
<span class="sd">            cell_size: Size of each cell in the grid.</span>
<span class="sd">            section_color: Color of the grid sections as an RGB tuple.</span>
<span class="sd">            section_thickness: Thickness of the section lines.</span>
<span class="sd">            section_size: Size of each section in the grid.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">GridMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                <span class="n">width_segments</span><span class="o">=</span><span class="n">width_segments</span><span class="p">,</span>
                <span class="n">height_segments</span><span class="o">=</span><span class="n">height_segments</span><span class="p">,</span>
                <span class="n">plane</span><span class="o">=</span><span class="n">plane</span><span class="p">,</span>
                <span class="n">cell_color</span><span class="o">=</span><span class="n">_encode_rgb</span><span class="p">(</span><span class="n">cell_color</span><span class="p">),</span>
                <span class="n">cell_thickness</span><span class="o">=</span><span class="n">cell_thickness</span><span class="p">,</span>
                <span class="n">cell_size</span><span class="o">=</span><span class="n">cell_size</span><span class="p">,</span>
                <span class="n">section_color</span><span class="o">=</span><span class="n">_encode_rgb</span><span class="p">(</span><span class="n">section_color</span><span class="p">),</span>
                <span class="n">section_thickness</span><span class="o">=</span><span class="n">section_thickness</span><span class="p">,</span>
                <span class="n">section_size</span><span class="o">=</span><span class="n">section_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">SceneNodeHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_label">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_label">[docs]</a>
    <span class="k">def</span> <span class="nf">add_label</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LabelHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a 2D label to the scene.</span>

<span class="sd">        This method creates a text label in the 3D scene, which can be used to annotate</span>
<span class="sd">        or provide information about specific points or objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the label.</span>
<span class="sd">            text: Text content of the label.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span><span class="n">_messages</span><span class="o">.</span><span class="n">LabelMessage</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">LabelHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_point_cloud">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_point_cloud">[docs]</a>
    <span class="k">def</span> <span class="nf">add_point_cloud</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">points</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">point_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">point_shape</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;square&quot;</span><span class="p">,</span> <span class="s2">&quot;diamond&quot;</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;rounded&quot;</span><span class="p">,</span> <span class="s2">&quot;sparkle&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PointCloudHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a point cloud to the scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of scene node. Determines location in kinematic tree.</span>
<span class="sd">            points: Location of points. Should have shape (N, 3).</span>
<span class="sd">            colors: Colors of points. Should have shape (N, 3) or (3,).</span>
<span class="sd">            point_size: Size of each point.</span>
<span class="sd">            point_shape: Shape to draw each point.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colors_cast</span> <span class="o">=</span> <span class="n">_colors_to_uint8</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="p">),</span> <span class="s2">&quot;Shape of points should be (N, 3).&quot;</span>
        <span class="k">assert</span> <span class="n">colors_cast</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,),</span>
        <span class="p">},</span> <span class="s2">&quot;Shape of colors should be (N, 3) or (3,).&quot;</span>

        <span class="k">if</span> <span class="n">colors_cast</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="n">colors_cast</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">colors_cast</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">reps</span><span class="o">=</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">PointCloudMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">colors_cast</span><span class="p">,</span>
                <span class="n">point_size</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span>
                <span class="n">point_ball_norm</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;square&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;diamond&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s2">&quot;circle&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="s2">&quot;rounded&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                    <span class="s2">&quot;sparkle&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
                <span class="p">}[</span><span class="n">point_shape</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">PointCloudHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_mesh_simple">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_mesh_simple">[docs]</a>
    <span class="k">def</span> <span class="nf">add_mesh_simple</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">vertices</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">faces</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span> <span class="o">=</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
        <span class="n">wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">material</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;standard&quot;</span><span class="p">,</span> <span class="s2">&quot;toon3&quot;</span><span class="p">,</span> <span class="s2">&quot;toon5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
        <span class="n">flat_shading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;front&quot;</span><span class="p">,</span> <span class="s2">&quot;back&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;front&quot;</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MeshHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a mesh to the scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            vertices: A numpy array of vertex positions. Should have shape (V, 3).</span>
<span class="sd">            faces: A numpy array of faces, where each face is represented by indices of</span>
<span class="sd">                vertices. Should have shape (F,)</span>
<span class="sd">            color: Color of the mesh as an RGB tuple.</span>
<span class="sd">            wireframe: Boolean indicating if the mesh should be rendered as a wireframe.</span>
<span class="sd">            opacity: Opacity of the mesh. None means opaque.</span>
<span class="sd">            material: Material type of the mesh (&#39;standard&#39;, &#39;toon3&#39;, &#39;toon5&#39;).</span>
<span class="sd">                This argument is ignored when wireframe=True.</span>
<span class="sd">            flat_shading: Whether to do flat shading. This argument is ignored</span>
<span class="sd">                when wireframe=True.</span>
<span class="sd">            side: Side of the surface to render (&#39;front&#39;, &#39;back&#39;, &#39;double&#39;).</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation from parent frame to local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this mesh is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">wireframe</span> <span class="ow">and</span> <span class="n">material</span> <span class="o">!=</span> <span class="s2">&quot;standard&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid combination of </span><span class="si">{</span><span class="n">wireframe</span><span class="si">=}</span><span class="s2"> and </span><span class="si">{</span><span class="n">material</span><span class="si">=}</span><span class="s2">. Material argument will be ignored.&quot;</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">wireframe</span> <span class="ow">and</span> <span class="n">flat_shading</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid combination of </span><span class="si">{</span><span class="n">wireframe</span><span class="si">=}</span><span class="s2"> and </span><span class="si">{</span><span class="n">flat_shading</span><span class="si">=}</span><span class="s2">. Flat shading argument will be ignored.&quot;</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">MeshMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">vertices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">faces</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span>
                <span class="c1"># (255, 255, 255) =&gt; 0xffffff, etc</span>
                <span class="n">color</span><span class="o">=</span><span class="n">_encode_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
                <span class="n">vertex_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">wireframe</span><span class="o">=</span><span class="n">wireframe</span><span class="p">,</span>
                <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
                <span class="n">flat_shading</span><span class="o">=</span><span class="n">flat_shading</span><span class="p">,</span>
                <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">MeshHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_mesh_trimesh">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_mesh_trimesh">[docs]</a>
    <span class="k">def</span> <span class="nf">add_mesh_trimesh</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">:</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlbHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a trimesh mesh to the scene. Internally calls `self.add_glb()`.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">              define a kinematic tree.</span>
<span class="sd">            mesh: A trimesh mesh object.</span>
<span class="sd">            scale: A scale for resizing the mesh.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">data_buffer</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">data_buffer</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;glb&quot;</span><span class="p">)</span>
            <span class="n">glb_data</span> <span class="o">=</span> <span class="n">data_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_glb</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">glb_data</span><span class="o">=</span><span class="n">glb_data</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">wxyz</span><span class="o">=</span><span class="n">wxyz</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_box">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_box">[docs]</a>
    <span class="k">def</span> <span class="nf">add_box</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span><span class="p">,</span>
        <span class="n">dimensions</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MeshHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a box to the scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            color: Color of the box as an RGB tuple.</span>
<span class="sd">            dimensions: Dimensions of the box (x, y, z).</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation from parent frame to local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this box is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">trimesh.creation</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh_simple</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">vertices</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span>
            <span class="n">faces</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">flat_shading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
            <span class="n">wxyz</span><span class="o">=</span><span class="n">wxyz</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_icosphere">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_icosphere">[docs]</a>
    <span class="k">def</span> <span class="nf">add_icosphere</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">RgbTupleOrArray</span><span class="p">,</span>
        <span class="n">subdivisions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MeshHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an icosphere to the scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            radius: Radius of the icosphere.</span>
<span class="sd">            color: Color of the icosphere as an RGB tuple.</span>
<span class="sd">            subdivisions: Number of subdivisions to use when creating the icosphere.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation from parent frame to local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this icosphere is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">trimesh.creation</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">icosphere</span><span class="p">(</span><span class="n">subdivisions</span><span class="o">=</span><span class="n">subdivisions</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>

        <span class="c1"># We use add_mesh_simple() because it lets us do smooth shading;</span>
        <span class="c1"># add_mesh_trimesh() currently does not.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh_simple</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">vertices</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span>
            <span class="n">faces</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">flat_shading</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
            <span class="n">wxyz</span><span class="o">=</span><span class="n">wxyz</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.set_background_image">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.set_background_image">[docs]</a>
    <span class="k">def</span> <span class="nf">set_background_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">,</span>
        <span class="n">jpeg_quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">depth</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a background image for the scene, optionally with depth compositing.</span>

<span class="sd">        Args:</span>
<span class="sd">            image: The image to set as the background. Should have shape (H, W, 3).</span>
<span class="sd">            format: Format to transport and display the image using (&#39;png&#39; or &#39;jpeg&#39;).</span>
<span class="sd">            jpeg_quality: Quality of the jpeg image (if jpeg format is used).</span>
<span class="sd">            depth: Optional depth image to use to composite background with scene elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">media_type</span><span class="p">,</span> <span class="n">base64_data</span> <span class="o">=</span> <span class="n">_encode_image_base64</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">jpeg_quality</span><span class="o">=</span><span class="n">jpeg_quality</span>
        <span class="p">)</span>

        <span class="c1"># Encode depth if provided. We use a 3-channel PNG to represent a fixed point</span>
        <span class="c1"># depth at each pixel.</span>
        <span class="n">depth_base64data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Convert to fixed-point.</span>
            <span class="c1"># We&#39;ll support from 0 -&gt; (2^24 - 1) / 100_000.</span>
            <span class="c1">#</span>
            <span class="c1"># This translates to a range of [0, 167.77215], with a precision of 1e-5.</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="s2">&quot;Depth should have shape (H,W) or (H,W,1).&quot;</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">depth</span> <span class="o">*</span> <span class="mi">100_000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">24</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># Appease mypy.</span>
            <span class="n">intdepth</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">intdepth</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="o">*</span><span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">data_buffer</span><span class="p">:</span>
                <span class="n">iio</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">data_buffer</span><span class="p">,</span> <span class="n">intdepth</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
                <span class="n">depth_base64data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                    <span class="s2">&quot;ascii&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">BackgroundImageMessage</span><span class="p">(</span>
                <span class="n">media_type</span><span class="o">=</span><span class="n">media_type</span><span class="p">,</span>
                <span class="n">base64_rgb</span><span class="o">=</span><span class="n">base64_data</span><span class="p">,</span>
                <span class="n">base64_depth</span><span class="o">=</span><span class="n">depth_base64data</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_image">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_image">[docs]</a>
    <span class="k">def</span> <span class="nf">add_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">render_width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">render_height</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">,</span>
        <span class="n">jpeg_quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a 2D image to the scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            image: A numpy array representing the image.</span>
<span class="sd">            render_width: Width at which the image should be rendered in the scene.</span>
<span class="sd">            render_height: Height at which the image should be rendered in the scene.</span>
<span class="sd">            format: Format to transport and display the image using (&#39;png&#39; or &#39;jpeg&#39;).</span>
<span class="sd">            jpeg_quality: Quality of the jpeg image (if jpeg format is used).</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation from parent frame to local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this image is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">media_type</span><span class="p">,</span> <span class="n">base64_data</span> <span class="o">=</span> <span class="n">_encode_image_base64</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">jpeg_quality</span><span class="o">=</span><span class="n">jpeg_quality</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">ImageMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">media_type</span><span class="o">=</span><span class="n">media_type</span><span class="p">,</span>
                <span class="n">base64_data</span><span class="o">=</span><span class="n">base64_data</span><span class="p">,</span>
                <span class="n">render_width</span><span class="o">=</span><span class="n">render_width</span><span class="p">,</span>
                <span class="n">render_height</span><span class="o">=</span><span class="n">render_height</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ImageHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span></div>


<div class="viewcode-block" id="SceneApi.add_transform_controls">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_transform_controls">[docs]</a>
    <span class="k">def</span> <span class="nf">add_transform_controls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">fixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">auto_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">active_axes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">disable_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">disable_sliders</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">disable_rotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">translation_limits</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span>
            <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)),</span>
        <span class="n">rotation_limits</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span>
            <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)),</span>
        <span class="n">depth_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformControlsHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a transform gizmo for interacting with the scene.</span>

<span class="sd">        This method adds a transform control (gizmo) to the scene, allowing for interactive</span>
<span class="sd">        manipulation of objects in terms of their position, rotation, and scale.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            scale: Scale of the transform controls.</span>
<span class="sd">            line_width: Width of the lines used in the gizmo.</span>
<span class="sd">            fixed: Boolean indicating if the gizmo should be fixed in position.</span>
<span class="sd">            auto_transform: Whether the transform should be applied automatically.</span>
<span class="sd">            active_axes: tuple of booleans indicating active axes.</span>
<span class="sd">            disable_axes: Boolean to disable axes interaction.</span>
<span class="sd">            disable_sliders: Boolean to disable slider interaction.</span>
<span class="sd">            disable_rotations: Boolean to disable rotation interaction.</span>
<span class="sd">            translation_limits: Limits for translation.</span>
<span class="sd">            rotation_limits: Limits for rotation.</span>
<span class="sd">            depth_test: Boolean indicating if depth testing should be used when rendering.</span>
<span class="sd">            opacity: Opacity of the gizmo.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation from parent frame to local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this gizmo is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating (and reading state of) scene node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">TransformControlsMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="n">fixed</span><span class="p">,</span>
                <span class="n">auto_transform</span><span class="o">=</span><span class="n">auto_transform</span><span class="p">,</span>
                <span class="n">active_axes</span><span class="o">=</span><span class="n">active_axes</span><span class="p">,</span>
                <span class="n">disable_axes</span><span class="o">=</span><span class="n">disable_axes</span><span class="p">,</span>
                <span class="n">disable_sliders</span><span class="o">=</span><span class="n">disable_sliders</span><span class="p">,</span>
                <span class="n">disable_rotations</span><span class="o">=</span><span class="n">disable_rotations</span><span class="p">,</span>
                <span class="n">translation_limits</span><span class="o">=</span><span class="n">translation_limits</span><span class="p">,</span>
                <span class="n">rotation_limits</span><span class="o">=</span><span class="n">rotation_limits</span><span class="p">,</span>
                <span class="n">depth_test</span><span class="o">=</span><span class="n">depth_test</span><span class="p">,</span>
                <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">sync_cb</span><span class="p">(</span><span class="n">client_id</span><span class="p">:</span> <span class="n">ClientId</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">TransformControlsHandle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message_orientation</span> <span class="o">=</span> <span class="n">_messages</span><span class="o">.</span><span class="n">SetOrientationMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">wxyz</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">_impl</span><span class="o">.</span><span class="n">wxyz</span><span class="p">)),</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="n">message_orientation</span><span class="o">.</span><span class="n">excluded_self_client</span> <span class="o">=</span> <span class="n">client_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span><span class="n">message_orientation</span><span class="p">)</span>

            <span class="n">message_position</span> <span class="o">=</span> <span class="n">_messages</span><span class="o">.</span><span class="n">SetPositionMessage</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">_impl</span><span class="o">.</span><span class="n">position</span><span class="p">)),</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="n">message_position</span><span class="o">.</span><span class="n">excluded_self_client</span> <span class="o">=</span> <span class="n">client_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span><span class="n">message_position</span><span class="p">)</span>

        <span class="n">node_handle</span> <span class="o">=</span> <span class="n">SceneNodeHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
        <span class="n">state_aux</span> <span class="o">=</span> <span class="n">_TransformControlsState</span><span class="p">(</span>
            <span class="n">last_updated</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="n">update_cb</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">sync_cb</span><span class="o">=</span><span class="n">sync_cb</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">TransformControlsHandle</span><span class="p">(</span><span class="n">node_handle</span><span class="o">.</span><span class="n">_impl</span><span class="p">,</span> <span class="n">state_aux</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_from_transform_controls_name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">handle</span>
        <span class="k">return</span> <span class="n">handle</span></div>


<div class="viewcode-block" id="SceneApi.reset">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the scene.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span><span class="n">_messages</span><span class="o">.</span><span class="n">ResetSceneMessage</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="nf">_get_client_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="n">ClientId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClientHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private helper for getting a client handle from its ID.&quot;&quot;&quot;</span>
        <span class="c1"># Avoid circular imports.</span>
        <span class="kn">from</span> <span class="nn">._viser</span> <span class="kn">import</span> <span class="n">ViserServer</span>

        <span class="c1"># Implementation-wise, note that MessageApi is never directly instantiated.</span>
        <span class="c1"># Instead, it serves as a mixin/base class for either ViserServer, which</span>
        <span class="c1"># maintains a registry of connected clients, or ClientHandle, which should</span>
        <span class="c1"># only ever be dealing with its own client_id.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">ViserServer</span><span class="p">):</span>
            <span class="c1"># TODO: there&#39;s a potential race condition here when the client disconnects.</span>
            <span class="c1"># This probably applies to multiple other parts of the code, we should</span>
            <span class="c1"># revisit all of the cases where we index into connected_clients.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">_connected_clients</span><span class="p">[</span><span class="n">client_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">client_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">client_id</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span>

    <span class="k">def</span> <span class="nf">_handle_transform_controls_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="n">ClientId</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">_messages</span><span class="o">.</span><span class="n">TransformControlsUpdateMessage</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for handling transform gizmo messages.&quot;&quot;&quot;</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_from_transform_controls_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Update state.</span>
        <span class="n">wxyz</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">wxyz</span><span class="p">)</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">_impl</span><span class="o">.</span><span class="n">wxyz</span> <span class="o">=</span> <span class="n">wxyz</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">_impl</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">_impl_aux</span><span class="o">.</span><span class="n">last_updated</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Trigger callbacks.</span>
        <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">handle</span><span class="o">.</span><span class="n">_impl_aux</span><span class="o">.</span><span class="n">update_cb</span><span class="p">:</span>
            <span class="n">cb</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle</span><span class="o">.</span><span class="n">_impl_aux</span><span class="o">.</span><span class="n">sync_cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">_impl_aux</span><span class="o">.</span><span class="n">sync_cb</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_node_click_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="n">ClientId</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">_messages</span><span class="o">.</span><span class="n">SceneNodeClickMessage</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for handling click messages.&quot;&quot;&quot;</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_from_node_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">handle</span><span class="o">.</span><span class="n">_impl</span><span class="o">.</span><span class="n">click_cb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">handle</span><span class="o">.</span><span class="n">_impl</span><span class="o">.</span><span class="n">click_cb</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">SceneNodePointerEvent</span><span class="p">(</span>
                <span class="n">client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_client_handle</span><span class="p">(</span><span class="n">client_id</span><span class="p">),</span>
                <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                <span class="n">event</span><span class="o">=</span><span class="s2">&quot;click&quot;</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                <span class="n">ray_origin</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">ray_origin</span><span class="p">,</span>
                <span class="n">ray_direction</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">ray_direction</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">cb</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">_handle_scene_pointer_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="n">ClientId</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">_messages</span><span class="o">.</span><span class="n">ScenePointerMessage</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for handling click messages.&quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">ScenePointerEvent</span><span class="p">(</span>
            <span class="n">client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_client_handle</span><span class="p">(</span><span class="n">client_id</span><span class="p">),</span>
            <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
            <span class="n">ray_origin</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">ray_origin</span><span class="p">,</span>
            <span class="n">ray_direction</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">ray_direction</span><span class="p">,</span>
            <span class="n">screen_pos</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">screen_pos</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Call the callback if it exists, and the after-run callback.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_cb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_cb</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<div class="viewcode-block" id="SceneApi.on_pointer_event">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.on_pointer_event">[docs]</a>
    <span class="k">def</span> <span class="nf">on_pointer_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;rect-select&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">ScenePointerEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ScenePointerEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a callback for scene pointer events.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_type: event to listen to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure the event type is valid.</span>
        <span class="k">assert</span> <span class="n">event_type</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">_messages</span><span class="o">.</span><span class="n">ScenePointerEventType</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">._viser</span> <span class="kn">import</span> <span class="n">ClientHandle</span><span class="p">,</span> <span class="n">ViserServer</span>

        <span class="k">def</span> <span class="nf">cleanup_previous_event</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">ViserServer</span> <span class="o">|</span> <span class="n">ClientHandle</span><span class="p">):</span>
            <span class="c1"># If the server or client does not have a scene pointer callback, return.</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">_scene_pointer_cb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># Remove callback.</span>
            <span class="n">target</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">remove_pointer_callback</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span>
            <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ScenePointerEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ScenePointerEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="c1"># Check if another scene pointer event was previously registered.</span>
            <span class="c1"># If so, we need to clear the previous event and register the new one.</span>
            <span class="n">cleanup_previous_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">)</span>

            <span class="c1"># If called on the server handle, remove all clients&#39; callbacks.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">ViserServer</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">get_clients</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">cleanup_previous_event</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

            <span class="c1"># If called on the client handle, and server handle has a callback, remove the server&#39;s callback.</span>
            <span class="c1"># (If the server has a callback, none of the clients should have callbacks.)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">ClientHandle</span><span class="p">):</span>
                <span class="n">server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">_viser_server</span>
                <span class="n">cleanup_previous_event</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_cb</span> <span class="o">=</span> <span class="n">func</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_event_type</span> <span class="o">=</span> <span class="n">event_type</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
                <span class="n">_messages</span><span class="o">.</span><span class="n">ScenePointerEnableMessage</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">return</span> <span class="n">decorator</span></div>


<div class="viewcode-block" id="SceneApi.on_pointer_callback_removed">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.on_pointer_callback_removed">[docs]</a>
    <span class="k">def</span> <span class="nf">on_pointer_callback_removed</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a callback to run automatically when the callback for a scene</span>
<span class="sd">        pointer event is removed. This will be triggered exactly once, either</span>
<span class="sd">        manually (via :meth:`remove_pointer_callback()`) or automatically (if</span>
<span class="sd">        the scene pointer event is overridden with another call to</span>
<span class="sd">        :meth:`on_pointer_event()`).</span>

<span class="sd">        Args:</span>
<span class="sd">            func: Callback for when scene pointer events are removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_done_cb</span> <span class="o">=</span> <span class="n">func</span>
        <span class="k">return</span> <span class="n">func</span></div>


<div class="viewcode-block" id="SceneApi.remove_pointer_callback">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.remove_pointer_callback">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_pointer_callback</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the currently attached scene pointer event. This will trigger</span>
<span class="sd">        any callback attached to `.on_scene_pointer_removed()`.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_cb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;No scene pointer callback exists for this server/client, ignoring.&quot;</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Notify client that the listener has been removed.</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_event_type</span>
        <span class="k">assert</span> <span class="n">event_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">ScenePointerEnableMessage</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Run cleanup callback.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_done_cb</span><span class="p">()</span>

        <span class="c1"># Reset the callback and event type, on the python side.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_cb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_done_cb</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene_pointer_event_type</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="SceneApi.add_3d_gui_container">
<a class="viewcode-back" href="../../../scene_api/#viser.SceneApi.add_3d_gui_container">[docs]</a>
    <span class="k">def</span> <span class="nf">add_3d_gui_container</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">wxyz</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">onp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Gui3dContainerHandle</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a 3D gui container to the scene. The returned container handle can be</span>
<span class="sd">        used as a context to place GUI elements into the 3D scene.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: A scene tree name. Names in the format of /parent/child can be used to</span>
<span class="sd">                define a kinematic tree.</span>
<span class="sd">            wxyz: Quaternion rotation to parent frame from local frame (R_pl).</span>
<span class="sd">            position: Translation to parent frame from local frame (t_pl).</span>
<span class="sd">            visible: Whether or not this scene node is initially visible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Handle for manipulating scene node. Can be used as a context to place GUI</span>
<span class="sd">            elements inside of the container.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Avoids circular import.</span>
        <span class="kn">from</span> <span class="nn">._gui_api</span> <span class="kn">import</span> <span class="n">_make_unique_id</span>

        <span class="c1"># New name to make the type checker happy; ViserServer and ClientHandle inherit</span>
        <span class="c1"># from both GuiApi and MessageApi. The pattern below is unideal.</span>
        <span class="n">gui_api</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">gui</span>

        <span class="c1"># Remove the 3D GUI container if it already exists. This will make sure</span>
        <span class="c1"># contained GUI elements are removed, preventing potential memory leaks.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_from_node_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_from_node_name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

        <span class="n">container_id</span> <span class="o">=</span> <span class="n">_make_unique_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_websock_interface</span><span class="o">.</span><span class="n">queue_message</span><span class="p">(</span>
            <span class="n">_messages</span><span class="o">.</span><span class="n">Gui3DMessage</span><span class="p">(</span>
                <span class="n">order</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">container_id</span><span class="o">=</span><span class="n">container_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">node_handle</span> <span class="o">=</span> <span class="n">SceneNodeHandle</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wxyz</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="n">visible</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Gui3dContainerHandle</span><span class="p">(</span><span class="n">node_handle</span><span class="o">.</span><span class="n">_impl</span><span class="p">,</span> <span class="n">gui_api</span><span class="p">,</span> <span class="n">container_id</span><span class="p">)</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/nerfstudio-project/viser" aria-label="GitHub">
            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
        </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=187304be"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>